# Восстановление золота из руды

Учебный проект прогнозирования сразу двух величин из большего количества признаков.

## Краткое описание

Нужно подготовить модель, которая должна предсказать коэффициент восстановления золота из золотосодержащей руды. Используются данные с параметрами добычи и очистки. Эффективность обогащения рассчитывается по специальной формуле.

Для прогноза коэффициента нужно найти долю золота в концентратах и хвостах. Причём важен не только финальный продукт, но и черновой концентрат.

---

## Задачи

**План работ**

1. Подготовка данных

    - Проверим, что эффективность обогащения рассчитана правильно. Вычислим её на обучающей выборке для признака rougher.output.recovery. Найдем MAE между расчётами и значением признака.

    - Проанализируем признаки, недоступные в тестовой выборке. Посмотрим, что это за параметры и к какому типу относятся.

    - Проведем предобработку данных.

2. Анализ данных

    - Посмотрим, как меняется концентрация металлов (Au, Ag, Pb) на различных этапах очистки.
    - Сравним распределения размеров гранул сырья на обучающей и тестовой выборках. Если распределения сильно отличаются друг от друга, оценка модели будет неправильной.
    - Исследуем суммарную концентрацию всех веществ на разных стадиях: в сырье, в черновом и финальном концентратах. 

3. Построение модели
    - Напишем функцию для вычисления итоговой sMAPE.
    - Обучим разные модели и оценим их качество кросс-валидацией. Выберем лучшую модель и проверим её на тестовой выборке. 

Нужно спрогнозировать сразу две величины:
   1. Эффективность обогащения чернового концентрата *rougher.output.recovery*;
   2. Эффективность обогащения финального концентрата *final.output.recovery*.

Чтобы это сделать, необходимо спрогнозировать долю золота, которая будет получаться после обогащения на каждом этапе и доли золота в хвостах.

Будем использовать метрики ***sMAPE*** и ***итогового sMAPE***.

---

## Данные

Данные находятся в трёх файлах:
* `gold_recovery_train_new.csv` — обучающая выборка;
* `gold_recovery_test_new.csv` — тестовая выборка;
* `gold_recovery_full_new.csv` — исходные данные.

Данные индексируются датой и временем получения информации (признак date). Соседние по времени параметры часто похожи.
Некоторые параметры недоступны, потому что замеряются и/или рассчитываются значительно позже. Из-за этого в тестовой выборке отсутствуют некоторые признаки, которые есть в обучающей. Также в тестовом наборе нет целевых признаков.

Исходный датасет содержит обучающую и тестовую выборки со всеми признаками.

Данные сырые: их просто выгрузили из хранилища.

Технологический процесс
* *Rougher feed* — исходное сырье
* *Rougher additions* (или *reagent additions*) — флотационные реагенты: Xanthate, Sulphate, Depressant 
    - Xanthate — ксантогенат (промотер, или активатор флотации);
    - Sulphate — сульфат (на данном производстве сульфид натрия);
    - Depressant — депрессант (силикат натрия).
* *Rougher process* (англ. «грубый процесс») — флотация
* *Rougher tails* — отвальные хвосты
* *Float banks* — флотационная установка
* *Cleaner process* — очистка
* *Rougher Au* — черновой концентрат золота
* *Final Au* — финальный концентрат золота

Параметры этапов
* *air amount* — объём воздуха
* *fluid levels* — уровень жидкости
* *feed size* — размер гранул сырья
* *feed rate* — скорость подачи

**Наименование признаков**

Наименование признаков должно быть такое:
[этап].[тип_параметра].[название_параметра]

Пример: *rougher.input.feed_ag*

Возможные значения для блока [этап]:
* *rougher* — флотация
* *primary_cleaner* — первичная очистка
* *secondary_cleaner* — вторичная очистка
* *final* — финальные характеристики

Возможные значения для блока [тип_параметра]:
* *input* — параметры сырья
* *output* — параметры продукта
* *state* — параметры, характеризующие текущее состояние этапа
* *calculation* — расчётные характеристики

## Используемые библиотеки

pandas, seaborn, matplotlib, numpy, sklearn, statsmodels
